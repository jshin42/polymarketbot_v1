# =============================================================================
# Pre-commit Configuration
# =============================================================================
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files
# =============================================================================

repos:
  # ---------------------------------------------------------------------------
  # Standard Pre-commit Hooks
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--unsafe]
      - id: check-json
      - id: check-toml
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: detect-private-key
      - id: no-commit-to-branch
        args: ['--branch', 'main', '--branch', 'master']

  # ---------------------------------------------------------------------------
  # Gitleaks - Secret Detection
  # ---------------------------------------------------------------------------
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.1
    hooks:
      - id: gitleaks
        name: Detect secrets with gitleaks
        description: Detect hardcoded secrets using Gitleaks
        entry: gitleaks protect --verbose --redact --staged
        language: golang
        pass_filenames: false

  # ---------------------------------------------------------------------------
  # Detect-Secrets - Additional Secret Scanning
  # ---------------------------------------------------------------------------
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        name: Detect secrets with detect-secrets
        args:
          - --baseline
          - .secrets.baseline
          - --exclude-files
          - '\.lock$'
          - --exclude-files
          - 'pnpm-lock\.yaml$'

  # ---------------------------------------------------------------------------
  # Prettier - Code Formatting
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        types_or: [javascript, typescript, json, yaml, markdown]
        exclude: 'pnpm-lock\.yaml$'

  # ---------------------------------------------------------------------------
  # Local Hooks
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      # TypeScript Type Checking
      - id: typecheck
        name: TypeScript type check
        entry: pnpm typecheck
        language: system
        pass_filenames: false
        types: [typescript]

      # ESLint
      - id: eslint
        name: ESLint
        entry: pnpm lint
        language: system
        pass_filenames: false
        types: [typescript]

      # Block Sensitive Patterns
      - id: block-secrets
        name: Block sensitive patterns
        entry: bash -c 'grep -rE "(PRIVATE_KEY|MNEMONIC|SEED_PHRASE|API_SECRET|WALLET_SECRET)\\s*=" --include="*.ts" --include="*.js" --include="*.json" --include="*.env" . && exit 1 || exit 0'
        language: system
        pass_filenames: false

      # Ensure .env is not committed
      - id: no-env-file
        name: Prevent .env commit
        entry: bash -c 'git diff --cached --name-only | grep -E "^\.env$" && echo "ERROR: Cannot commit .env file!" && exit 1 || exit 0'
        language: system
        pass_filenames: false

# =============================================================================
# CI Configuration
# =============================================================================
ci:
  autofix_commit_msg: 'style: auto-fix by pre-commit hooks'
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: 'chore: update pre-commit hooks'
  autoupdate_schedule: weekly
  skip: [typecheck, eslint]  # These need full repo context in CI
  submodules: false
